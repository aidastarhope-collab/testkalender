<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adventskalender</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  
  <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #08121e 0%, #13213c 25%, #253356 50%, #111723 75%, #08121e 100%);
      background-attachment: fixed;
      padding: 20px;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    
    /* Snowflakes */
    .snowflake {
      position: fixed;
      top: -10px;
      color: white;
      font-size: 1em;
      user-select: none;
      z-index: 1;
      pointer-events: none;
      animation: fall linear infinite;
      filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.8));
    }
    
    @keyframes fall {
      to {
        transform: translateY(100vh);
      }
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }
    
    /* Logo Header */
    .logo-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .logo-header img {
      max-width: 500px;
      width: 100%;
      height: auto;
      filter: drop-shadow(0 8px 20px rgba(0,0,0,0.6)) drop-shadow(0 4px 10px rgba(0,0,0,0.4));
    }
    
    /* Fallback wenn kein Bild geladen wird */
    h1 {
      text-align: center;
      color: white;
      font-size: 3em;
      margin-bottom: 30px;
      text-shadow: 0 4px 8px rgba(0,0,0,0.5), 0 2px 4px rgba(0,0,0,0.3);
      font-family: 'Playfair Display', serif;
      font-weight: 700;
    }
    
    .hidden { display: none; }
    
    /* Login Styles */
    #login {
      background: white;
      max-width: 400px;
      margin: 50px auto;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.5), 0 8px 20px rgba(0,0,0,0.3);
    }
    
    #login h2 {
      color: #1e315b;
      margin-bottom: 20px;
      text-align: center;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    #login input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }
    
    #login input:focus {
      outline: none;
      border-color: #1e315b;
      box-shadow: 0 4px 8px rgba(30, 49, 91, 0.2);
    }
    
    #login button {
      width: 100%;
      padding: 12px;
      background: #1e315b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(30, 49, 91, 0.4);
    }
    
    #login button:hover {
      background: #2d3e6a;
      box-shadow: 0 6px 16px rgba(30, 49, 91, 0.5);
      transform: translateY(-2px);
    }
    
    #login-msg {
      color: #1e315b;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }
    
    /* Calendar Styles */
    #calendar {
      color: white;
    }
    
    .welcome-section {
      text-align: center;
      margin-bottom: 30px;
      background: rgba(255,255,255,0.1);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
    }
    
    .welcome-section h2 {
      font-size: 2em;
      margin-bottom: 10px;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      text-shadow: 0 3px 8px rgba(0,0,0,0.4);
    }
    
    #progress {
      font-size: 1.3em;
      font-weight: bold;
      color: #ffffff;
      text-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    
    .logout-btn {
      padding: 10px 30px;
      background: white;
      color: #1e315b;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin-top: 15px;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    
    .logout-btn:hover {
      background: #f0f0f0;
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
    }
    
    /* Door Grid */
    #doors {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 200px;
      margin-top: 30px;
    }
    
    /* Double Door Container */
    .door-container {
      position: relative;
      height: 280px;
      perspective: 1000px;
      filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
    }
    
    .door-container:hover {
      filter: drop-shadow(0 15px 40px rgba(0,0,0,0.6));
    }
    
    /* Locked Door Styling */
    .door-container.locked .door-left,
    .door-container.locked .door-right {
      cursor: not-allowed;
      filter: brightness(0.6);
    }
    
    .door-container.locked .door-left:hover,
    .door-container.locked .door-right:hover {
      filter: brightness(0.6);
    }
    
    .door-content {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #2d3e6a 0%, #1e2c4a 100%);
      border-radius: 12px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      border: 3px solid #13213c;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.3), 0 4px 20px rgba(0,0,0,0.4);
    }
    
    .door-content h3 {
      color: white;
      margin-bottom: 15px;
      font-size: 1.3em;
      text-align: center;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      text-shadow: 0 2px 8px rgba(0,0,0,0.5);
    }
    
    .door-content .story-btn {
      background: linear-gradient(135deg, #13213c 0%, #111723 100%);
      color: white;
      border: 2px solid #13213c;
      margin-bottom: 15px;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }
    
    .door-content .story-btn:hover {
      background: linear-gradient(135deg, #1a2947 0%, #15182a 100%);
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(255, 255, 255, 0.3), 0 0 20px rgba(255, 255, 255, 0.2);
    }
    
    .door-content input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid white;
      border-radius: 6px;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .door-content button {
      width: 100%;
      padding: 10px;
      background: white;
      color: #08121e;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      margin-bottom: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
    }
    
    .door-content button:hover {
      background: #6b81b2;
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    }
    
    .door-content .close-btn {
      background: transparent;
      border: 2px solid white;
      color: white;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }
    
    .door-content .close-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .door-content .status {
      text-align: center;
      margin-top: 5px;
      font-size: 1.3em;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* Double Doors */
    .door-left, .door-right {
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: linear-gradient(135deg, #2d4270 0%, #253356 50%, #1e2947 100%);
      border: 3px solid #13213c;
      transition: transform 1s ease-in-out;
      transform-style: preserve-3d;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: inset 0 2px 8px rgba(255,255,255,0.1), 
                  inset 0 -2px 8px rgba(0,0,0,0.3),
                  0 4px 15px rgba(0,0,0,0.4);
    }
    
    .door-left {
      left: 0;
      border-radius: 12px 0 0 12px;
      transform-origin: left;
    }
    
    .door-right {
      right: 0;
      border-radius: 0 12px 12px 0;
      transform-origin: right;
    }
    
    .door-container.open .door-left {
      transform: rotateY(-120deg);
    }
    
    .door-container.open .door-right {
      transform: rotateY(120deg);
    }
    
    .door-number {
      color: white;
      font-size: 3em;
      font-weight: bold;
      text-shadow: 0 4px 12px rgba(0,0,0,0.7), 
                   0 2px 6px rgba(0,0,0,0.5),
                   0 0 20px rgba(255,255,255,0.1);
      pointer-events: none;
      transition: opacity 0.3s;
    }
    
    .door-container.open .door-number {
      opacity: 0;
    }
    
    .door-container.open .crystal-icon {
      opacity: 0;
    }
    
    .door-left .door-number {
      margin-left: 20px;
    }
    
    .door-right .door-number {
      margin-right: 20px;
    }
    
    /* Crystal Image on right door */
    .crystal-icon {
      width: 70px;
      height: 70px;
      object-fit: contain;
      filter: drop-shadow(0 4px 12px rgba(255,255,255,0.4)) 
              drop-shadow(0 2px 6px rgba(255,255,255,0.2));
      transition: opacity 0.3s;
    }
    
    .door-left:hover, .door-right:hover {
      filter: brightness(1.15);
      box-shadow: inset 0 2px 8px rgba(255,255,255,0.15), 
                  inset 0 -2px 8px rgba(0,0,0,0.3),
                  0 6px 20px rgba(0,0,0,0.5);
    }
    
    /* Lock Icon */
.lock-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10;
  pointer-events: none;
  transition: all 0.6s ease-out;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.6));
}

.door-container.unlocking .lock-container {
  animation: lockFall 0.8s ease-in forwards;
}

@keyframes lockFall {
  0% {
    transform: translate(-50%, -50%) rotate(0deg);
    opacity: 1;
  }
  70% {
    transform: translate(-50%, 100px) rotate(180deg);
    opacity: 0.5;
  }
  100% {
    transform: translate(-50%, 150px) rotate(360deg);
    opacity: 0;
  }
}

.door-container:not(.locked) .lock-container {
  display: none;
}

.lock-icon {
  width: 80px;  /* Adjust size as needed */
  height: auto;
}
    
    /* Story Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease-out;
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    .modal-content {
      background: linear-gradient(135deg, #2d3e6a 0%, #132a4a 100%);
      border: 3px solid #08121e;
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7), 
                  0 10px 30px rgba(0, 0, 0, 0.5),
                  inset 0 1px 0 rgba(255,255,255,0.1);
      animation: slideIn 0.4s ease-out;
      position: relative;
    }
    
    @keyframes slideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    .modal-content h2 {
      color: #FFFFFF;
      font-family: 'Playfair Display', serif;
      font-size: 2em;
      margin-bottom: 20px;
      text-align: center;
      text-shadow: 0 3px 10px rgba(0,0,0,0.6);
    }
    
    .modal-content p {
      color: white;
      font-size: 1.1em;
      line-height: 1.8;
      margin-bottom: 15px;
      text-align: justify;
      text-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    
    .modal-close-btn {
      width: 100%;
      padding: 12px;
      background: #6b81b2;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin-top: 20px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    
    .modal-close-btn:hover {
      background: #7a91c7;
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
    }
    
    /* Responsive */
    @media (max-width: 1000px) {
      #doors {
        grid-template-columns: repeat(3, 1fr);
        gap: 90px;
      }
      
      .logo-header img {
        max-width: 400px;
      }
    }
    
    @media (max-width: 700px) {
      #doors {
        grid-template-columns: repeat(2, 1fr);
        gap: 70px;
      }
      
      .door-container {
        height: 250px;
      }
      
      h1 {
        font-size: 2em;
      }
      
      .logo-header img {
        max-width: 300px;
      }
      
      .lock-icon {
        width: 90px;
        height: 100px;
      }
      
      .lock-body {
        width: 50px;
        height: 38px;
      }
      
      .lock-shackle {
        width: 25px;
        height: 30px;
        border-width: 6px;
      }
    }
    
    @media (max-width: 500px) {
      #doors {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .logo-header img {
        max-width: 250px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Logo Header - Ersetze "logo.png" mit deinem Bildpfad -->
    <div class="logo-header">
      <img src="bgr.png" alt="CG Adventskalender" onerror="this.style.display='none'; document.getElementById('fallback-title').style.display='block';">
    </div>
    <h1 id="fallback-title" style="display: none;">üéÑ CG Adventskalender üéÑ</h1>
    
    <div id="login">
      <h2>Login</h2>
      <input id="username" placeholder="Benutzername">
      <input id="password" placeholder="Passwort" type="password">
      <button onclick="login()">Einloggen</button>
      <div id="login-msg"></div>
    </div>

    <div id="calendar" class="hidden">
      <div class="welcome-section">
        <h2>Willkommen, <span id="userLabel"></span>!</h2>
        <p id="progress"></p>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
      <div id="doors"></div>
    </div>
  </div>

  <!-- Story Modal -->
  <div class="modal-overlay" id="storyModal">
    <div class="modal-content">
      <h2 id="modalTitle">T√ºrchen 1</h2>
      <div id="modalStory"></div>
      <button class="modal-close-btn" onclick="closeStoryModal()">Schlie√üen</button>
    </div>
  </div>

  <script>
    // Create snowflakes
    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.classList.add('snowflake');
      snowflake.innerHTML = '‚ùÑ';
      snowflake.style.left = Math.random() * 100 + '%';
      snowflake.style.animationDuration = Math.random() * 3 + 5 + 's';
      snowflake.style.opacity = Math.random();
      snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
      
      document.body.appendChild(snowflake);
      
      setTimeout(() => {
        snowflake.remove();
      }, 8000);
    }
    
    // Create snowflakes periodically
    setInterval(createSnowflake, 200);
    
    // Initial snowflakes
    for (let i = 0; i < 50; i++) {
      setTimeout(createSnowflake, i * 100);
    }

    const firebaseConfig = {
      apiKey: "AIzaSyC1QIEr0IjLVQx-WlYYG1iRo08LmyuqWXY",
      authDomain: "cg-adventskalender.firebaseapp.com",
      projectId: "cg-adventskalender",
      storageBucket: "cg-adventskalender.firebasestorage.app",
      messagingSenderId: "823914577697",
      appId: "1:823914577697:web:5885b5e51513a21bd80860"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentUser = null;

    // Story-Texte f√ºr jedes T√ºrchen - HIER DEINE GESCHICHTEN EINF√úGEN!
    const storyTexts = {
      1: `<p>Der erste Schnee fiel √ºber Celsia, und doch f√ºhlte er sich falsch an. Normalerweise brachte er ein leises Kribbeln aus Erinnerungen mit sich an Lichterketten in den Fenstern, an Kinder, die im Hof lachten, an den Duft von Gew√ºrzen, der aus K√ºchen str√∂mte. Dieses Jahr aber lag etwas Schweres in der Luft, etwas Unausgesprochenes.
Ich stand im Tempel des Azur und sah hinaus auf die Stadt. Der Wind malte Muster in die Flocken, als w√ºrde er mindestens drei verschiedene Geschichten gleichzeitig erz√§hlen. Und tief in meiner Brust klopfte etwas, das nicht mein eigenes Herz war.</p><p>
Der Celsissplitter.</p><p>
Er war kein Fremdk√∂rper mehr, kein simples Fragment eines zerst√∂rten Kristalls. Er war in mir, mit mir verwachsen, eingeflochten in mein Blut. Manchmal, nachts, wenn alles still war, konnte ich seinen Puls h√∂ren ein zweiter Herzschlag, kalt, aber vertraut. Und heute war er unruhig, als w√ºsste er etwas, das ich noch nicht verstand.</p><p>
</p><p><strong>Deine Aufgabe:</strong> Hier steht mal eine Frage oder Aufgabe.</p>`,
      2: `<p>Hier steht mal ein Story Snippet</p><p><strong>Deine Aufgabe:</strong> Hier steht mal eine Frage oder Aufgabe.</p>`,
      3: `<p>Hier steht mal ein Story Snippet</p><p><strong>Deine Aufgabe:</strong> Hier steht mal eine Frage oder Aufgabe.</p>`,
      4: `<p>Hier steht mal ein Story Snippet</p><p><strong>Deine Aufgabe:</strong> Hier steht mal eine Frage oder Aufgabe.</p>`,
      5: `<p>Hier steht mal ein Story Snippet</p><p><strong>Deine Aufgabe:</strong> Hier steht mal eine Frage oder Aufgabe.</p>`,
      6: `<p>Hier steht mal ein Story Snippet</p><p><strong>Deine Aufgabe:</strong> Hier steht mal eine Frage oder Aufgabe.</p>`,
      7: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`,
      8: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`,
      9: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`,
      10: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`,
      11: `<p>Ein magisches Artefakt wird entdeckt!</p><p><strong>Deine Aufgabe:</strong> Welche Kraft hat es?</p>`,
      12: `<p>Die H√§lfte des Abenteuers ist geschafft! Ein gro√ües Fest wird gefeiert.</p><p><strong>Deine Aufgabe:</strong> Was gibt es zu essen?</p>`,
      13: `<p>Die Geschichte nimmt eine unerwartete Wendung...</p><p><strong>Deine Aufgabe:</strong> Was passiert als n√§chstes?</p>`,
      14: `<p>Ein Schneesturm zieht auf! Die Guards m√ºssen Schutz suchen.</p><p><strong>Deine Aufgabe:</strong> Wo finden sie Unterschlupf?</p>`,
      15: `<p>Die dritte Woche beginnt... Ein neuer Verb√ºndeter erscheint!</p><p><strong>Deine Aufgabe:</strong> Wer ist es?</p>`,
      16: `<p>Die Guards entdecken eine geheime Botschaft...</p><p><strong>Deine Aufgabe:</strong> Was steht in der Botschaft?</p>`,
      17: `<p>Ein gef√§hrlicher Gegner taucht auf!</p><p><strong>Deine Aufgabe:</strong> Wie sieht er aus?</p>`,
      18: `<p>Die Guards m√ºssen eine wichtige Entscheidung treffen...</p><p><strong>Deine Aufgabe:</strong> Welche?</p>`,
      19: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Welche Farbe hat er?</p>`,
      20: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Was ist das gro√üe Ziel?</p>`,
      21: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`,
      22: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`,
      23: `<p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`,
      24: `<p>Platzhalter</p><p>Platzhalter</p><p><strong>Deine Aufgabe:</strong> Platzhalter</p>`
    };

    function openStoryModal(doorNumber) {
      document.getElementById('modalTitle').innerText = 'T√ºrchen ' + doorNumber;
      document.getElementById('modalStory').innerHTML = storyTexts[doorNumber] || '<p>Hier k√∂nnte deine Geschichte stehen...</p>';
      document.getElementById('storyModal').classList.add('active');
    }

    function closeStoryModal() {
      document.getElementById('storyModal').classList.remove('active');
    }

    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('storyModal');
      if (event.target === modal) {
        closeStoryModal();
      }
    });

    // Check if door should be unlocked based on current date
    function isDoorUnlocked(doorNumber) {
  const now = new Date();
  const currentDay = now.getDate();
  const currentMonth = now.getMonth() + 1; // 0-indexed
  
  // Only unlock in December and ONLY on the exact day
  if (currentMonth === 12 && doorNumber === currentDay) {
    return true;
  }
  
  return false;
}

    function login() {
      const name = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      
      if (!name || !pass) {
        document.getElementById("login-msg").innerText = "Bitte beide Felder ausf√ºllen.";
        return;
      }

      db.collection("users").doc(name).get()
        .then(doc => {
          if (!doc.exists) {
            document.getElementById("login-msg").innerText = "Benutzer nicht gefunden.";
            return;
          }
          if (doc.data().password !== pass) {
            document.getElementById("login-msg").innerText = "Falsches Passwort.";
            return;
          }
          
          currentUser = name;
          document.getElementById("userLabel").innerText = name;
          document.getElementById("login").classList.add("hidden");
          document.getElementById("calendar").classList.remove("hidden");
          document.getElementById("login-msg").innerText = "";
          loadAnswers();
        })
        .catch(error => {
          console.error("Fehler beim Login:", error);
          document.getElementById("login-msg").innerText = "Verbindungsfehler. Bitte erneut versuchen.";
        });
    }

    function logout() {
      currentUser = null;
      document.getElementById("calendar").classList.add("hidden");
      document.getElementById("login").classList.remove("hidden");
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }

    function toggleDoor(i) {
      const container = document.getElementById("door-container-" + i);
      
      // Check if door is locked
      if (container.classList.contains("locked")) {
        // Show message that door is still locked
        alert("Dieses T√ºrchen kann erst am " + i + ". Dezember ge√∂ffnet werden! üéÑ");
        return;
      }
      
      if (container.classList.contains("open")) {
        // Close door
        container.classList.remove("open");
      } else {
        // Open door
        container.classList.add("open");
      }
    }

    function loadAnswers() {
      const container = document.getElementById("doors");
      container.innerHTML = "";
      
      db.collection("answers").doc(currentUser).get()
        .then(doc => {
          const data = doc.exists ? doc.data() : {};
          let answered = 0;
          
          for (let i = 1; i <= 24; i++) {
            const key = "tag" + i;
            const val = data[key] || "";
            if (val) answered++;
            
            const doorContainer = document.createElement("div");
            doorContainer.className = "door-container";
            doorContainer.id = "door-container-" + i;
            
            const isUnlocked = isDoorUnlocked(i);
            if (!isUnlocked) {
              doorContainer.classList.add("locked");
            }
            
            const lockHTML = !isUnlocked ? `
              <div class="lock-container">
                <img src="lockn.png" class="lock-icon" alt="Locked">
              </div>
            ` : '';
            
            doorContainer.innerHTML = `
              <div class="door-content">
                <h3>T√ºrchen ${i}</h3>
                <button class="story-btn" onclick="openStoryModal(${i})">üìñ Story lesen</button>
                <input id="input${i}" value="${val}" placeholder="Deine Antwort">
                <button onclick="saveAnswer(${i})">Speichern</button>
                <button class="close-btn" onclick="toggleDoor(${i})">Schlie√üen</button>
                <div class="status" id="status${i}"></div>
              </div>
              ${lockHTML}
              <div class="door-left" onclick="toggleDoor(${i})">
                <div class="door-number">${i}</div>
              </div>
              <div class="door-right" onclick="toggleDoor(${i})">
                <img src="glasb.png" class="crystal-icon" alt="Crystal" onerror="this.style.display='none'; this.parentElement.innerHTML += '<div class=\\'door-number\\'>üéÅ</div>';">
              </div>
            `;
            
            container.appendChild(doorContainer);
          }
          
          document.getElementById("progress").innerText = `abgeschlossen: ${answered}/24 üéÅ`;
        })
        .catch(error => {
          console.error("Fehler beim Laden:", error);
        });
    }

    function saveAnswer(i) {
      const val = document.getElementById("input" + i).value.trim();
      if (!val) return;
      
      const key = "tag" + i;
      db.collection("answers").doc(currentUser).set({ [key]: val }, { merge: true })
        .then(() => {
          document.getElementById("status" + i).innerText = "‚úÖ Gespeichert!";
          setTimeout(() => {
            toggleDoor(i);
            setTimeout(() => loadAnswers(), 600);
          }, 1000);
        })
        .catch(error => {
          console.error("Fehler beim Speichern:", error);
          alert("Fehler beim Speichern. Bitte erneut versuchen.");
        });
    }
  </script>
</body>
</html>
